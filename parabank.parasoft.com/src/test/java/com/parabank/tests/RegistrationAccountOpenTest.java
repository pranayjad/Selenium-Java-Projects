package com.parabank.tests;

import com.parabank.pageobjects.OpenNewAccountPage;
import com.parabank.pageobjects.RegistrationPage;
import com.parabank.testComponents.BaseTest;
import org.testng.Assert;
import org.testng.annotations.DataProvider;
import org.testng.annotations.Test;

import java.io.IOException;
import java.util.HashMap;
import java.util.List;

public class RegistrationAccountOpenTest extends BaseTest {

    public RegistrationPage registrationPage;

    @Test (dataProvider = "getData",groups = {"HappyPath"}, description = "TC-102, User registration")
    public void registration_TC102(HashMap<String,String> input) {

        registrationPage = landingPage.goToRegisterPage();
        registrationPage.registerUser(input.get("username"));
        Assert.assertTrue(registrationPage.getRegistrationStatus().contains("created successfully"));
    }

    @Test(dependsOnMethods = {"registration_TC102"}, description = "TC-106, Open New Account post successful user registration")
    public void openAccount_TC106()
    {
        OpenNewAccountPage openNewAcctPage = registrationPage.goToOpenNewAcctPage();
        openNewAcctPage.openNewAcct();
        Assert.assertTrue(openNewAcctPage.getAcctOpenStatus().contains("Account Opened"));
        System.out.println("New account no is: "+openNewAcctPage.getNewAcctNo());

        openNewAcctPage.goToLogOut();
    }

    @Test (dataProvider = "getData", groups = {"NegativeScenario"}, description = "TC-103, User Registration using existing user data")
    public void registration_ExistingUserData_TC103(HashMap<String,String> input)
    {
        registrationPage = landingPage.goToRegisterPage();
        registrationPage.registerUser(input.get("username"));
        Assert.assertTrue(registrationPage.getRegistrationStatus_ExistingUserData().contains("This username already exists."));
    }

    @DataProvider
    public Object[][] getData() throws IOException {
        List<HashMap<String,String>> mapData = getJsonDataToMap(System.getProperty("user.dir")+"//src//test//java//com//parabank//data//data.json");
        return new Object [][] {{mapData.get(0)}};
    }

}
